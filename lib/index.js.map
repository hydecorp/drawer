{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["/** \n * Copyright (c) 2020 Florian Klampfer <https://qwtel.com/>\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <http://www.gnu.org/licenses/>.\n * \n * @license \n * @nocompile\n */\nimport { html, property, customElement, query } from 'lit-element';\nimport { classMap } from 'lit-html/directives/class-map';\nimport { styleMap } from 'lit-html/directives/style-map';\n\nimport { Observable, Subject, BehaviorSubject, combineLatest, merge, NEVER, defer, fromEvent } from \"rxjs\";\nimport { startWith, takeUntil, map, share, withLatestFrom, tap, sample, timestamp, pairwise, filter, switchMap, skip, finalize } from 'rxjs/operators';\n\nimport { RxLitElement, createResolvablePromise } from '@hydecorp/component';\n\nimport { BASE_DURATION, WIDTH_CONTRIBUTION } from './constants';\nimport { applyMixins, filterWhen, easeOutSine, observeWidth, rangeConverter, rangeHasChanged, tween } from './common';\nimport { ObservablesMixin, Coord } from './observables';\nimport { CalcMixin } from './calc';\nimport { UpdateMixin, DOMUpdater } from './update';\nimport { styles } from './styles';\n\n@customElement('hy-drawer')\nexport class HyDrawer \n    extends applyMixins(RxLitElement, [ObservablesMixin, UpdateMixin, CalcMixin])\n    implements ObservablesMixin, UpdateMixin, CalcMixin {\n\n  static styles = styles;\n\n  @query('.scrim') scrimEl!: HTMLElement;\n  @query('.wrapper') contentEl!: HTMLElement;\n  @query('.peek') peekEl!: HTMLElement;\n\n  @property({ type: Boolean, reflect: true }) opened: boolean = false;\n  @property({ type: String, reflect: true }) side: \"left\" | \"right\" = \"left\";\n  @property({ type: Boolean, reflect: true }) persistent: boolean = false;\n  @property({ type: Number, reflect: true }) threshold: number = 10;\n  @property({ type: Boolean, reflect: true }) noScroll: boolean = false;\n  @property({ type: Boolean, reflect: true }) mouseEvents: boolean = false;\n  // @property({ type: Boolean, reflect: true }) hashChange: boolean = false;\n  @property({ reflect: true, converter: rangeConverter, hasChanged: rangeHasChanged }) range: [number, number] = [0, 100];\n\n  // State\n  @property() scrimClickable!: boolean;\n  @property() grabbing!: boolean;\n  @property() willChange: boolean = false;\n\n  #initialized = createResolvablePromise();\n  get initialized() {\n    return this.#initialized;\n  }\n \n  // get histId() { return this.id || this.tagName; }\n  // get hashId() { return `#${this.histId}--opened`; }\n\n  translateX!: number;\n  opacity!: number;\n  isSliding!: boolean;\n\n  $!: {\n    opened: Subject<boolean>;\n    side: Subject<\"left\" | \"right\">;\n    persistent: Subject<boolean>;\n    preventDefault: Subject<boolean>;\n    mouseEvents: Subject<boolean>;\n    // hashChange: Subject<boolean>;\n  };\n\n  animateTo$!: Subject<boolean>;\n\n  // TODO: Prefer composition to mixins...\n  // ObservablesMixin\n  getStartObservable!: () => Observable<Coord>;\n  getMoveObservable!: (start: Observable<Coord>, end: Observable<Coord>) => Observable<Coord>;\n  getEndObservable!: () => Observable<Coord>;\n  getIsSlidingObservable!: (move: Observable<Coord>, start: Observable<Coord>, end: Observable<Coord>) => Observable<boolean>;\n  getIsSlidingObservableInner!: (move: Observable<Coord>, start: Observable<Coord>) => Observable<boolean>;\n\n  // CalcMixin\n  calcIsInRange!: (start: Coord, opened: boolean) => boolean;\n  calcIsSwipe!: (start: Coord, end: Coord, translateX: number, drawerWidth: number, _: number) => boolean;\n  calcWillOpen!: (start: {}, end: {}, translateX: number, drawerWidth: number, velocity: number) => boolean;\n  calcTranslateX!: (move: Coord, start: Coord, startTranslateX: number, drawerWidth: number) => number;\n\n  // UpdateMixin\n  updateDOM!: (translateX: number, drawerWidth: number) => void;\n  updater!: DOMUpdater;\n\n  // HyDrawer\n  getDrawerWidth(): Observable<number> {\n    const content$ = observeWidth(this.contentEl)\n      .pipe(tap(px => this.fireEvent('content-width-change', { detail: px })));\n    const peek$ = observeWidth(this.peekEl)\n      .pipe(tap(px => this.fireEvent('peek-width-change', { detail: px })));\n\n    return combineLatest([content$, peek$]).pipe(\n      // takeUntil(this.subjects.disconnect),\n      map(([contentWidth, peekWidth]) => contentWidth - peekWidth),\n      share(),\n    );\n  }\n\n  // private consolidateState() {\n  //   const hashOpened = location.hash === this.hashId;\n  //   const isReload = history.state && history.state[this.histId];\n  //   if (isReload) {\n  //     if (hashOpened !== this.opened) {\n  //       this.opened = hashOpened;\n  //     }\n  //   } else {\n  //     const url = new URL(location.href);\n  //     const newState = { ...history.state, [this.histId]: { backable: false } };\n  //     if (hashOpened && !this.opened) {\n  //       url.hash = '';\n  //       history.replaceState(newState, document.title, url.href);\n\n  //       url.hash = this.hashId;\n  //       history.pushState({ [this.histId]: { backable: true } }, document.title, url.href);\n\n  //       this.opened = true;\n  //     }\n  //     else if (!hashOpened && this.opened) {\n  //       history.replaceState(newState, document.title, url.href);\n\n  //       url.hash = this.hashId;\n  //       history.pushState({ [this.histId]: { backable: true } }, document.title, url.href);\n  //     }\n  //     else {\n  //       history.replaceState(newState, document.title, url.href);\n  //     }\n  //   }\n  // }\n\n  connectedCallback() {\n    super.connectedCallback();\n\n    // if (this.hashChange) this.consolidateState()\n\n    this.$ = {\n      opened: new BehaviorSubject(this.opened),\n      side: new BehaviorSubject(this.side),\n      persistent: new BehaviorSubject(this.persistent),\n      preventDefault: new BehaviorSubject(this.noScroll),\n      mouseEvents: new BehaviorSubject(this.mouseEvents),\n      // hashChange: new BehaviorSubject(this.hashChange),\n    };\n\n    this.scrimClickable = this.opened\n    this.animateTo$ = new Subject<boolean>();\n    this.updater = DOMUpdater.getUpdaterForPlatform(this);\n    this.updateComplete.then(this.upgrade);\n  }\n\n  #translateX$!: Observable<number>;\n  #startTranslateX$!: Observable<number>;\n  #tweenTranslateX$!: Observable<number>;\n\n  upgrade = () => {\n    const drawerWidth$ = this.getDrawerWidth();\n    const active$ = this.$.persistent.pipe(map(_ => !_));\n\n    const start$ = this.getStartObservable().pipe(\n      // takeUntil(this.subjects.disconnect),\n      filterWhen(active$),\n      share(),\n    );\n\n    const isScrimVisible$ = defer(() => {\n      return this.#translateX$.pipe(map(translateX => translateX !== 0))\n    });\n\n    const isInRange$ = start$.pipe(\n      withLatestFrom(isScrimVisible$),\n      map(args => this.calcIsInRange(...args)),\n      tap((inRange) => {\n        if (inRange) {\n          this.willChange = true;\n          this.fireEvent('prepare');\n        }\n      }),\n      share(),\n    );\n\n    const end$ = this.getEndObservable().pipe(\n      // takeUntil(this.subjects.disconnect),\n      filterWhen(active$, isInRange$),\n      tap(() => { if (this.mouseEvents) this.grabbing = false; }),\n      share(),\n    );\n\n    const move$ = this.getMoveObservable(start$, end$).pipe(\n      // takeUntil(this.subjects.disconnect),\n      filterWhen(active$, isInRange$),\n      share(),\n    );\n\n    const isSliding$ = this.getIsSlidingObservable(move$, start$, end$).pipe(\n      tap(isSliding => {\n        this.isSliding = isSliding;\n        if (isSliding && this.mouseEvents) this.grabbing = true;\n        // if (isSliding) this.fireEvent('slidestart', { detail: this.opened });\n      })\n    );\n\n    const translateX$ = this.#translateX$ = defer(() => {\n      const jumpTranslateX$ = combineLatest([this.$.opened, this.$.side, drawerWidth$]).pipe(\n        map(([opened, side, drawerWidth]) => {\n          return !opened ? 0 : drawerWidth * (side === \"left\" ? 1 : -1);\n        }),\n      );\n\n      const moveTranslateX$ = move$.pipe(\n        filterWhen(isSliding$),\n        tap(() => (this.scrimClickable = false)),\n        tap(({ event }) => event && this.noScroll && event.preventDefault()),\n        withLatestFrom(start$, this.#startTranslateX$, drawerWidth$),\n        map(args => this.calcTranslateX(...args))\n      );\n\n      return merge(this.#tweenTranslateX$, jumpTranslateX$, moveTranslateX$);\n    }).pipe(share());\n\n    this.#startTranslateX$ = translateX$.pipe(sample(start$));\n\n    const velocity$ = translateX$.pipe(\n      timestamp(),\n      pairwise(),\n      filter(([{ timestamp: prevTime }, { timestamp: time }]) => time - prevTime > 0),\n      map(\n        ([{ value: prevX, timestamp: prevTime }, { value: x, timestamp: time }]) =>\n          (x - prevX) / (time - prevTime)\n      ),\n      startWith(0),\n    );\n\n    const willOpen$ = end$.pipe(\n      withLatestFrom(start$, translateX$, drawerWidth$, velocity$),\n      filter(args => this.calcIsSwipe(...args)),\n      map(args => this.calcWillOpen(...args)),\n      // TODO: only fire `slideend` event when slidestart fired as well?\n      // tap(willOpen => this.fireEvent('slideend', { detail: willOpen })),\n    );\n\n    const animateTo$ = this.animateTo$.pipe(tap(() => {\n      this.willChange = true;\n      this.fireEvent('prepare');\n    }));\n\n    this.#tweenTranslateX$ = merge(willOpen$, animateTo$).pipe(\n      withLatestFrom(translateX$, drawerWidth$),\n      switchMap(([willOpen, translateX, drawerWidth]) => {\n        const inv = this.side === \"left\" ? 1 : -1;\n        const endTranslateX = willOpen ? drawerWidth * inv : 0;\n        const diffTranslateX = endTranslateX - translateX;\n        const duration = Math.ceil(BASE_DURATION + drawerWidth * WIDTH_CONTRIBUTION);\n\n        return tween(easeOutSine, translateX, diffTranslateX, duration).pipe(\n          finalize(() => { this.transitioned(willOpen) }),\n          takeUntil(start$),\n          takeUntil(this.$.side.pipe(skip(1))),\n          share(),\n        );\n      })\n    );\n\n    translateX$.pipe(\n      withLatestFrom(drawerWidth$),\n      tap((args) => {\n        this.updateDOM(...args);\n        const { translateX, opacity } = this;\n        this.fireEvent('move', { detail: { translateX, opacity }, bubbles: false });\n      }),\n    ).subscribe();\n\n    fromEvent(this.scrimEl, \"click\").pipe(\n      // takeUntil(this.subjects.disconnect),\n      tap(() => this.close()),\n    ).subscribe();\n\n    active$.pipe(\n      // takeUntil(this.subjects.disconnect),\n      tap((active) => {\n        this.scrimEl.style.display = active ? \"block\" : \"none\";\n      }),\n    ).subscribe();\n\n    this.$.mouseEvents.pipe(\n      // takeUntil(this.subjects.disconnect),\n      switchMap(mouseEvents => {\n        return mouseEvents\n          ? start$.pipe(withLatestFrom(isInRange$))\n          : NEVER;\n      }),\n      filter(([coord, isInRange]) => isInRange && coord.event != null),\n      tap(([{ event }]) => event && event.preventDefault()),\n    ).subscribe();\n\n    // fromEvent(window, 'hashchange').pipe(\n    //   // takeUntil(this.subjects.disconnect),\n    //   subscribeWhen(this.$.hashChange),\n    //   tap(() => {\n    //     const opened = location.hash === this.hashId;\n    //     if (!history.state && opened) {\n    //       history.replaceState({ [this.histId]: { backable: true } }, document.title)\n    //     }\n\n    //     // If the state doesn't match open/close the drawer\n    //     if (opened !== this.opened) this.animateTo$.next(opened);\n    //   }),\n    // ).subscribe();\n\n    this.fireEvent(\"init\", { detail: this.opened });\n    this.#initialized.resolve(this);\n  }\n\n  private transitioned = (hasOpened: boolean) => {\n    this.opened = this.scrimClickable = hasOpened;\n    this.willChange = false;\n\n    // if (this.hashChange) this.transitionedHash(hasOpened)\n\n    this.fireEvent('transitioned', { detail: hasOpened });\n  }\n\n  // private transitionedHash(hasOpened: boolean) {\n  //   const hasClosed = !hasOpened;\n  //   const { backable } = history.state && history.state[this.histId] || { backable: false }\n  //   if (hasClosed && backable) {\n  //     history.back()\n  //   } \n  //   if (hasOpened && location.hash !== this.hashId) {\n  //     location.hash = this.hashId;\n  //   }\n  // }\n\n  render() {\n    return html`\n      <div class=\"peek full-height\"></div>\n      <div\n        class=\"scrim\"\n        style=${styleMap({\n          willChange: this.willChange ? 'opacity' : '',\n          pointerEvents: this.scrimClickable ? 'all' : '',\n        })}>\n      </div>\n      ${this.mouseEvents && this.grabbing && !this.scrimClickable \n        ? html`<div class=\"grabbing-screen full-screen\"></div>` \n        : null}\n      <div\n        class=${classMap({\n          wrapper: true,\n          'full-height': true,\n          [this.side]: true,\n          grab: this.mouseEvents,\n          grabbing: this.mouseEvents && this.grabbing,\n        })}\n        style=${styleMap({ \n          willChange: this.willChange ? 'transform' : '',\n        })}\n      >\n        <div class=\"overflow\">\n          <slot></slot>\n        </div>\n      </div>\n    `;\n  }\n\n  @property()\n  open() {\n    this.animateTo$.next(true);\n  }\n\n  @property()\n  close() {\n    this.animateTo$.next(false);\n  }\n\n  @property()\n  toggle() {\n    this.animateTo$.next(!this.opened);\n  }\n}\n"]}